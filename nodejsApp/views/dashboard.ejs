<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Dashboard - <%= service %></title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .card h3 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-connected { background-color: #27ae60; }
        .status-disconnected { background-color: #e74c3c; }
        .api-list {
            list-style: none;
            padding: 0;
        }
        .api-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #ecf0f1;
        }
        .api-method {
            font-weight: bold;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        .method-get { background: #3498db; color: white; }
        .method-post { background: #2ecc71; color: white; }
        .refresh-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        .refresh-btn:hover { background: #2980b9; }
        .metric-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><%= service %> Dashboard</h1>
            <nav>
                <a href="/">Home</a>
                <a href="/users">Users</a>
                <a href="/dashboard">Dashboard</a>
                <a href="/health">Health</a>
                <a href="/metrics">Metrics</a>
            </nav>
        </header>

        <div class="dashboard-grid">
            <!-- Service Info -->
            <div class="card">
                <h3>Service Information</h3>
                <p><strong>Service:</strong> <%= service %></p>
                <p><strong>Version:</strong> <%= version %></p>
                <p><strong>Uptime:</strong> <%= system.uptime %> seconds</p>
                <p><strong>Last Updated:</strong> <%= new Date(timestamp).toLocaleString() %></p>
                <button class="refresh-btn" onclick="location.reload()">Refresh</button>
            </div>

            <!-- Database Status -->
            <div class="card">
                <h3>Database Status</h3>
                <p>
                    <span class="status-indicator <%= database.status === 'Connected' ? 'status-connected' : 'status-disconnected' %>"></span>
                    <strong>Status:</strong> <%= database.status %>
                </p>
                <p><strong>Type:</strong> <%= database.type %></p>
                <p><strong>Connection:</strong> <%= database.url %></p>
            </div>

            <!-- System Metrics -->
            <div class="card">
                <h3>System Metrics</h3>
                <p><strong>Platform:</strong> <%= system.platform %></p>
                <p><strong>Architecture:</strong> <%= system.arch %></p>
                <p><strong>Node.js:</strong> <%= system.nodeVersion %></p>
                <p><strong>CPUs:</strong> <%= system.cpus %></p>
                <p><strong>Memory Usage:</strong></p>
                <ul style="margin: 5px 0; padding-left: 20px;">
                    <li>RSS: <span class="metric-value"><%= Math.round(system.memory.rss / 1024 / 1024) %> MB</span></li>
                    <li>Heap Used: <span class="metric-value"><%= Math.round(system.memory.heapUsed / 1024 / 1024) %> MB</span></li>
                    <li>Heap Total: <span class="metric-value"><%= Math.round(system.memory.heapTotal / 1024 / 1024) %> MB</span></li>
                </ul>
            </div>

            <!-- API Endpoints -->
            <div class="card">
                <h3>Available APIs</h3>
                <ul class="api-list">
                    <% apis.forEach(api => { %>
                    <li class="api-item">
                        <div>
                            <span class="api-method method-<%= api.method.toLowerCase() %>"><%= api.method %></span>
                            <strong><%= api.path %></strong>
                        </div>
                        <div><%= api.description %></div>
                    </li>
                    <% }) %>
                </ul>
            </div>
        </div>

        <script>
            // Auto-refresh every 30 seconds
            setTimeout(() => location.reload(), 30000);
            
            // Add click handlers for API endpoints
            document.querySelectorAll('.api-item').forEach(item => {
                const path = item.querySelector('strong').textContent;
                const method = item.querySelector('.api-method').textContent;
                
                if (method === 'GET' && path !== '/register') {
                    item.style.cursor = 'pointer';
                    item.onclick = () => {
                        if (path === '/dashboard') return; // Don't navigate to self
                        window.open(path, '_blank');
                    };
                }
            });
        </script>
    </div>
</body>
</html>
